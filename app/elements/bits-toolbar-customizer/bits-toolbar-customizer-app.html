<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../base-message-center/base-message-center.html">
<link rel="import" href="../../bower_components/app-layout/app-layout.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">

<!-- import global object TOOLBAR_CUSTOMIZER with query definitions-->
<script type="text/javascript" src="./bits-toolbar-customizer-constants.js"></script>

<dom-module id="bits-toolbar-customizer-app">
  <template>
    <style include="iron-flex iron-flex-alignment">

      :host {
        display: block;
        width: 100vw;
        overflow-x: auto;
      }

      .button-container {
        width: 60%
      }

      app-toolbar {
        background-color: #4285f4;
        color: #fff;
        margin: 10px 5% 0;
        width: 90%;
      }

      paper-checkbox.spacer {
        margin: 0 5px;
      }

      paper-checkbox {
        align-self: center;
        border: 2px solid #1e88e5;
        padding: 8px 16px;
        border-radius: 13px;

        --paper-checkbox-checked-color: #04d7a1;
        --paper-checkbox-checked-ink-color: #04d7a1;
        --paper-checkbox-unchecked-color: #003399;
        --paper-checkbox-unchecked-ink-color: #003399;
        --paper-checkbox-label-color: #003399;
        --paper-checkbox-label-spacing: 0;
        --paper-checkbox-margin: 8px 16px 8px 0;
        --paper-checkbox-vertical-align: top;
        --paper-checkbox-label-checked-color: #ff0000;
      }

      paper-checkbox[disabled] {
        background-color: #f0f0f0;
      }

      paper-button.custom {
        --paper-button-ink-color: var(--paper-red-a200);
        --paper-button-flat-keyboard-focus: {
          background-color: var(--paper-blue-500);
          color: white !important;
        };
        --paper-button-raised-keyboard-focus: {
          background-color: var(--paper-red-a200) !important;
          color: white !important;
        };

        margin: 20px 0px;

        border-radius: 13px;
      }

      paper-button.custom:hover {
        background-color: var(--paper-blue-100);
      }

      paper-button {
        background-color: var(--paper-blue-500);
        color: white;
      }

      paper-button[active] {
        background-color: var(--paper-blue-700);
      }

      paper-button.disabled {
        color: white;
        background-color: #bfbfbf;
      }

      span.title {
        display: block;
        font-size: 1.3em;
      }

      span .subtitle {
        display: block;
        font-size: 0.7em;
        max-width: 150px;
      }

      label.section-header {
        margin: 20px 5px;
        font-size: 1.5em;
        color: #0033cc;
      }

      label.section-header[disabled] {
        color:#bfbfbf;
      }

      div.container {
        margin: 40px auto;
        width: 1200px;
      }

    </style>

    <app-toolbar class="tabs-bar">
      <div main-title>BITS Toolbar Customizer</div>
    </app-toolbar>

  <div class="layout vertical container">
    <label class="section-header">Hide the following toolbar items</label>

    <div class="layout horizontal start-justified">
      <paper-checkbox class="spacer" checked={{gallery::change}}>
        <span class="title">GALLERY</span>
        <span class="subtitle">
          Button to open the sidebar (stack icon)
        </span>
      </paper-checkbox>

      <paper-checkbox class="spacer" checked={{logo::change}}>
        <span class="title">BITS LOGO</span>
        <span class="subtitle">
          BITS Logo (Rendered as "BITS" or stack icon)
        </span>
      </paper-checkbox>

      <paper-checkbox class="spacer" checked={{powerMenu::change}}>
        <span class="title">POWER MENU</span>
        <span class="subtitle">
          Menu with system controls
        </span>
      </paper-checkbox>
    </div>

    <label class="section-header" disabled$=[[powerMenu]]>Hide the following power menu items</label>
    <div class="layout horizontal start-justified">
      <paper-checkbox class="spacer" checked={{powerOff::change}} disabled=[[powerMenu]]>
        <span class="title">POWER OFF</span>
        <span class="subtitle">
          Power off server host
        </span>
      </paper-checkbox>

      <paper-checkbox class="spacer" checked={{reboot::change}} disabled=[[powerMenu]]>
        <span class="title">REBOOT</span>
        <span class="subtitle">
          Reboot server host
        </span>
      </paper-checkbox>

      <paper-checkbox class="spacer" checked={{signOut::change}} disabled=[[powerMenu]]>
        <span class="title">SIGN OUT</span>
        <span class="subtitle">
          Sign out of BITS
        </span>
      </paper-checkbox>
    </div>

    <label class="section-header">Hide the following Sidebar item</label>
    <div class="layout horizontal start-justified">
      <paper-checkbox class="spacer" checked={{homeSidebar::change}}>
        <span class="title">HOME</span>
        <span class="subtitle">
          The /home page route and sidebar link to it
        </span>
      </paper-checkbox>
    </div>

    <label class="section-header" disabled$=[[homeSidebar]]>Hide the following Home Sidebar items</label>
    <div class="layout horizontal start-justified">
      <paper-checkbox class="spacer" checked={{dashboard::change}} disabled=[[homeSidebar]]>
        <span class="title">Dashboard</span>
      </paper-checkbox>

      <paper-checkbox class="spacer" checked={{activity::change}} disabled=[[homeSidebar]]>
        <span class="title">Activity</span>
      </paper-checkbox>

      <paper-checkbox class="spacer" checked={{users::change}} disabled=[[homeSidebar]]>
        <span class="title">Users</span>
      </paper-checkbox>

      <paper-checkbox class="spacer" checked={{omgs::change}} disabled=[[homeSidebar]]>
        <span class="title">OMGs</span>
      </paper-checkbox>

      <paper-checkbox class="spacer" checked={{modules::change}} disabled=[[homeSidebar]]>
        <span class="title">Modules</span>
      </paper-checkbox>

      <paper-checkbox class="spacer" checked={{logs::change}} disabled=[[homeSidebar]]>
        <span class="title">Logs</span>
      </paper-checkbox>
    </div>

    <div class="layout horizontal start-justified">
      <paper-button raised class="custom" on-tap='_onSaveChanges'>Save Changes</paper-button>
    </div>
  </div>

  </template>
  <script>
  ((global) => {
    'use strict';

    const BreakException = {};

    const QUERY_DEFS = TOOLBAR_CUSTOMIZER.QUERIES;

    const REQUESTS = TOOLBAR_CUSTOMIZER.REQUESTS;

    Polymer({

      is: 'bits-toolbar-customizer-app',

      behaviors: [global.Bits.BaseMessageCenterBehavior],

      properties: {
        gallery: {
          type: Boolean,
          notify: true
        },
        logo: {
          type: Boolean,
          notify: true
        },
        powerMenu: {
          type: Boolean,
          notify: true
        },
        powerOff: {
          type: Boolean,
          notify: true
        },
        reboot: {
          type: Boolean,
          notify: true
        },
        signOut: {
          type: Boolean,
          notify: true
        },
        homeSidebar: {
          type: Boolean,
          notify: true
        },
        dashboard: {
          type: Boolean,
          notify: true
        },
        activity: {
          type: Boolean,
          notify: true
        },
        users: {
          type: Boolean,
          notify: true
        },
        omgs: {
          type: Boolean,
          notify: true
        },
        modules: {
          type: Boolean,
          notify: true
        },
        logs: {
          type: Boolean,
          notify: true
        }
      },

      ready: function() {

      },

      _onSaveChanges(e) {
        // console.log(`save ${JSON.stringify(e)}`);
        // Object.keys(this.properties).forEach( (key) => {
        //   console.log(key, this[key]);
        // });
        const queries = {ownerDocument: [], toolbar: []}
        const toolbarQueries = [];
        Object.keys(this.properties).forEach( (prop) => {
          if (typeof this[prop] != 'undefined' && this[prop]) {
            const entry = QUERY_DEFS[prop]
            queries[entry.target].push(entry.query);
            if (prop === 'homeSidebar') {
              queries[entry.target].push(QUERY_DEFS['homeLink'].query);
            }
          }
        });
        console.log(JSON.stringify(queries, null, 2));
        this.sendRequest(REQUESTS.SET_CUSTOMIZATIONS, queries);
      },

      listeners: {
        'home-menu-changed': '_onhomeSidebar',
        'power-menu-changed': '_onPowerMenu',
      },

      _onhomeSidebar: function(e) {
        console.log(`Home menu hidden: ${e.detail.value}`);
      },

      _onPowerMenu: function(e) {
        console.log(`Power menu hidden: ${e.detail.value}`);
      }

    });

  })(window);
  </script>
</dom-module>
